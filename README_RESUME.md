# レジューム機能 使用ガイド

VideoTranscriptAnalyzerの中断・再開機能に関する完全ガイド

## 📋 目次

1. [概要](#概要)
2. [基本的な使い方](#基本的な使い方)
3. [インタラクティブメニュー](#インタラクティブメニュー)
4. [ステータス管理](#ステータス管理)
5. [実行例](#実行例)
6. [トラブルシューティング](#トラブルシューティング)

## 📖 概要

レジューム機能は、長時間かかる処理の中断と再開を可能にする機能です。

### 主な特徴

- ✅ **中断からの再開**: プロセスが中断されても、最後のステップから再開可能
- ✅ **進捗状況の表示**: 各ステップの実行状況をリアルタイムで確認
- ✅ **部分的な再実行**: 特定のステップだけを選択して再実行

## 🚀 基本的な使い方

### 新規実行

通常通りコマンドを実行します：

```bash
# URLから処理
python video_transcript_analyzer.py -u "https://youtube.com/watch?v=xxxxx"

# ローカルファイルから処理
python video_transcript_analyzer.py -f "path/to/video.mp4"
```

処理が開始されると、自動的に `output/` ディレクトリにプロジェクトフォルダが作成され、進捗が `status.json` に保存されます。

### 中断からの再開

処理が中断された場合、以下のコマンドで再開できます：

```bash
python video_transcript_analyzer.py --resume
# または
python video_transcript_analyzer.py -r
```

## 📱 インタラクティブメニュー

### プロジェクト選択メニュー

`--resume` オプションを使用すると、再開可能なプロジェクトのリストが表示されます：

```
======================================================================
📁 再開可能なプロジェクト:
======================================================================

1. [2024-01-15 14:30] video_20240115_143023
   入力: https://youtube.com/watch?v=xxxxx...
   進捗: ✅ ✅ 🔄
   現在: 文字起こし 実行中

2. [2024-01-14 09:15] video_20240114_091502
   入力: /path/to/local_video.mp4...
   進捗: ✅ ❌

----------------------------------------------------------------------
選択してください (番号を入力, 'q'でキャンセル):
> 1
```

### ステップ選択メニュー

プロジェクトを選択すると、実行するステップを選択できます：

```
======================================================================
🔧 実行するステップを選択:
======================================================================

1. ✅ 動画ダウンロード
   出力: video.mp4

2. 🔄 文字起こし
   進捗: 45/120 セグメント

3. ⬜ AI分析

4. ⬜ 階層的要約

5. ⬜ レポート生成

0. 🔄 最後の未完了ステップから続行

----------------------------------------------------------------------
選択してください (番号を入力, 'q'でキャンセル):
> 0
```

## 📊 ステータス管理

### ステップの状態

各処理ステップは以下の状態を持ちます：

| アイコン | 状態 | 説明 |
|---------|------|------|
| ⬜ | 未開始 | まだ実行されていない |
| 🔄 | 実行中 | 現在処理中 |
| ✅ | 完了 | 正常に完了 |
| ❌ | エラー | エラーで中断 |
| ⏭️ | スキップ | 意図的にスキップ |

### status.json の構造

```json
{
  "project_id": "video_20240115_143023",
  "created_at": "2024-01-15T14:30:23.456789",
  "updated_at": "2024-01-15T14:45:30.123456",
  "input_source": "https://youtube.com/watch?v=xxxxx",
  "config": {
    "language": "ja",
    "model_size": "large-v2",
    "compute_type": "float16"
  },
  "steps": {
    "download": {
      "status": "completed",
      "started_at": "2024-01-15T14:30:24.000000",
      "completed_at": "2024-01-15T14:32:15.000000",
      "output_file": "output/video_20240115_143023/downloads/video.mp4",
      "progress": 100
    },
    "transcribe": {
      "status": "in_progress",
      "started_at": "2024-01-15T14:32:16.000000",
      "progress": 37.5,
      "segments_processed": 45,
      "total_segments": 120
    },
    "analyze": {
      "status": "not_started",
      "progress": 0
    }
  }
}
```

## 💡 実行例

### 例1: 通常の再開

```bash
# 中断されたプロジェクトを再開
$ python video_transcript_analyzer.py --resume

# プロジェクトリストから選択
> 1

# 続きから実行を選択
> 0

🔄 文字起こし を再開します...
処理を開始: segment 46/120...
```

### 例2: 特定ステップの再実行

```bash
# AI分析だけを再実行したい場合
$ python video_transcript_analyzer.py --resume

# プロジェクトを選択
> 2

# AI分析ステップを選択
> 3

🔄 AI分析 を実行します...
```

### 例3: エラーからの復旧

エラーが発生したステップから再開：

```bash
$ python video_transcript_analyzer.py --resume

# エラーが発生したプロジェクトを選択
> 1

# 0を選択すると、エラーが発生したステップから再開
> 0

❌ 階層的要約 でエラーが発生していました
再実行を開始します...
```

## 🔧 トラブルシューティング

### Q: プロジェクトがリストに表示されない

**A:** 以下を確認してください：
- プロジェクトが `output/` ディレクトリに存在するか
- `status.json` ファイルが存在するか
- プロジェクトが既に完了していないか（完了済みは表示されません）

### Q: ステップの再実行ができない

**A:** 以下の理由が考えられます：
- 前提となるステップが完了していない（例：ダウンロードなしで文字起こしは不可）
- 必要なファイルが削除されている
- `status.json` が破損している

### Q: 進捗が更新されない

**A:** 処理中は定期的に `status.json` が更新されます。以下を確認：
- ディスクの空き容量
- 書き込み権限
- プロセスが正常に動作しているか

### Q: 複数のプロジェクトを並行処理したい

**A:** 現在のバージョンでは、1つのプロジェクトずつの処理となります。
複数のターミナルで別々のプロジェクトを実行することは可能です。

## 📝 補足情報

### プロジェクトの手動削除

不要になったプロジェクトは手動で削除できます：

```bash
# 特定のプロジェクトを削除
rm -rf output/video_20240115_143023/

# すべての未完了プロジェクトを削除
rm -rf output/video_*/
```

### ログファイルの確認

詳細なログは各プロジェクトフォルダ内に保存されます：

```bash
# ログファイルの確認
tail -f output/video_20240115_143023/processing.log
```

### コマンドラインオプション

その他の利用可能なオプション：

```bash
# ヘルプの表示
python video_transcript_analyzer.py -h

# 詳細モードで実行
python video_transcript_analyzer.py --resume --verbose

# 特定の設定ファイルを使用
python video_transcript_analyzer.py --resume --config custom_config.json
```

## 🤝 サポート

問題が解決しない場合は、以下の情報を含めてissueを作成してください：

1. エラーメッセージの全文
2. `status.json` の内容
3. 実行したコマンド
4. システム環境（OS、Python バージョンなど）